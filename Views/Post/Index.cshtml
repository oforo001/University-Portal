@using University_Portal.Helpers
@model IEnumerable<University_Portal.Models.Post>

@{
    ViewData["Title"] = "Blog Posts";
}

<link rel="stylesheet" href="~/css/createPost.css" asp-append-version="true" />

<div class="text-center mb-4">
    @if (ViewBag.Categories != null)
    {
        foreach (var category in ViewBag.Categories)
        {
            <a asp-action="Index"
               asp-route-categoryId="@category.Id"
               class="badge rounded-pill bg-warning text-dark px-3 py-2 me-2 category-badge">
                @category.Name
            </a>
        }
    }
</div>

<div class="text-end mb-4">
    <a class="btn btn-primary shadow-sm"
       asp-controller="Post"
       asp-action="Create">
        + Create New Post
    </a>
</div>

<div class="row row-cols-1 row-cols-md-3 g-4">
    @foreach (var post in Model)
    {
        <div class="col">
            <div class="card blog-card h-100 border-0">

                @if (!string.IsNullOrEmpty(post.FeatureImagePath))
                {
                    <img src="@Url.Content(post.FeatureImagePath)"
                         class="card-img-top"
                         alt="@post.Title"
                         style="height:260px; object-fit:cover;" />
                }

                <div class="card-body d-flex flex-column">

                    @if (post.Category != null)
                    {
                        <span class="badge bg-primary mb-2 align-self-start">
                            @post.Category.Name
                        </span>
                    }

                    <h5 class="card-title fw-bold">
                        @post.Title
                    </h5>

                    <small class="text-muted mb-2">
                        By <strong>@post.Author</strong> ·
                        @post.PublishDate.ToString("MMM dd, yyyy")
                    </small>

                    @{
                        var content = RemoveHtmlTagHelper.RemoveHtmlTags(post.Content);
                    }

                    <p class="card-text">
                        @(content.Length > 100 ? content.Substring(0, 100) + "..." : content)
                    </p>

                    <a asp-action="Details"
                       asp-controller="Post"
                       asp-route-id="@post.Id"
                       class="btn btn-outline-primary mt-auto">
                        Read more →
                    </a>

                </div>
            </div>
        </div>
    }
</div>
